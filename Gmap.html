<!DOCTYPE HTML>
	<!--  2测量-->
	<!--  3图层切换-->
<head>
    <title>Google Earth</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <script src="http://code.jquery.com/jquery-2.1.1.min.js"></script>
    <link href="./openlayer3-v6.3.1/ol.css" rel="stylesheet" type="text/css" />
    <script src="./openlayer3-v6.3.1/ol.js" type="text/javascript"></script>
    <style type="text/css">
        body, html {
            margin: 0 0 0 0;
            overflow: hidden hidden;
        }

        #mapCon {
            width: 100%;
            height: 100%;
            position: absolute;
        }

        #mouse-position { /* 鼠标位置控件层样式设置 */
            float: right;
            position: absolute;
            left: 50%;
            bottom: 10px;
            width: 140px;
            height: 21px;
            z-index: 2000;
        }
        .custom-mouse-position { /* 鼠标位置信息自定义样式设置 */
            margin: 1px;
            padding: 0;
            padding-top: 3px;
            height: 19px;
            color: #9c9b88;
            font-size: 12px;
            text-decoration: none;
            /*line-height: ;*/
            text-align: center;
            background-color: rgba(0, 100, 255, 0.23);
            border: none;
        }

        div .btn_group { /* 图层切换 */

            top: 0.5em;
            right: 0.5em;
            position: absolute;
            background-color: rgba(255,255,255,.4);
            border-radius: 4px;
            padding: 2px;
        }

        .btn_group .layer_btn {
            display: block;
            margin: 1px;
            padding: 0;
            color: #fff;
            font-size: 0.8em;
            text-align: center;
            height: 2.2em;
            width: 2.2em;
            line-height: 0.5em;
            background-color: rgba(0,60,136,.5);
            border: 0;
            border-radius: 2px;
        }

        .btn_group .layer_btn:hover{
            background-color: rgba(0,60,136,0.8);
        }

        #layer_s {
            display: none;
        }

    </style>
</head>
<body>
    <div id="mapCon"></div>
    <div id="mouse-position"></div>
    <div>
        <div class="btn_group">
            <button class="layer_btn" id="layer_m">2D</button>
            <button class="layer_btn" id="layer_s">卫星</button>
            <button class="layer_btn" id="layer_h">路网</button>
        </div>
    </div>
</body>
<script type="text/javascript">
    // 实例化比例尺控件（ScaleLine）
    var scaleLineControl = new ol.control.ScaleLine({
        units: "metric"  //设置比例尺单位，degrees、imperial、us、nautical、metric（度量单位）
    });

    // 实例化鼠标位置控件
    var mousePositionControl = new ol.control.MousePosition({
        coordinateFormat: ol.coordinate.createStringXY(4), //坐标格式
        projection: 'EPSG:4326',  //地图投影坐标系（若未设置则输出为默认投影坐标系下的坐标）
        className: 'custom-mouse-position', //坐标信息显示样式，默认是'ol-mouse-position'
        target: document.getElementById('mouse-position'), //显示鼠标位置信息的目标容器
        undefinedHTML: '0_0' //未定义坐标的标记
    });


    // mt: Google地图使用了四个服务地址，即 http://mt(0-3).google.cn/......，
        // 地图：http://mt2.google.cn/vt/lyrs=m@&hl=zh-CN&gl=cn&x=...
        // 影像底图：http://mt3.google.cn/vt/lyrs=s@110&hl=zh-CN&gl=cn&x=...
        // 影像的叠加：http://mt1.google.cn/vt/imgtp=png32&lyrs=h&hl=zh-CN&gl=cn&x=...
    // lyrs:  表示的是图层类型，即瓦片类型，具体含义如下：
        // m：路线图 ​t：地形图 ​p：带标签的地形图 ​s：卫星图 ​y：带标签的卫星图 ​h：标签层（路名、地名等）

    //初始化地图图层
    var gMap_t = new ol.layer.Tile({
        title: "地形图层",
        source: new ol.source.XYZ({
            url: "http://mt3.google.cn/vt/lyrs=t&hl=zh-CN&gl=cn&x={x}&y={y}&z={z}&s=Galile",
            wrapX: false
        })
    });

    var gMap_m = new ol.layer.Tile({
        title: "2D图层",
        source: new ol.source.XYZ({
            url: "http://mt3.google.cn/vt/lyrs=m&hl=zh-CN&gl=cn&x={x}&y={y}&z={z}&s=Galile",
            wrapX: false
        })
    });

    var gMap_s = new ol.layer.Tile({
        title: "卫星图层",
        source: new ol.source.XYZ({
            url: "http://mt3.google.cn/vt/lyrs=s&hl=zh-CN&gl=cn&x={x}&y={y}&z={z}&s=Galile",
            wrapX: false
        })
    });

    var gMap_h = new ol.layer.Tile({
        title: "路网图层",
        source: new ol.source.XYZ({
            url: "http://mt3.google.cn/vt/lyrs=h&hl=zh-CN&gl=cn&x={x}&y={y}&z={z}&s=Galile",
            wrapX: false
        })
    });

    var LayerArr = [gMap_t, gMap_m, gMap_s, gMap_h];

    //实例化Map对象加载地图
    var map = new ol.Map({
        target: 'mapCon', //地图容器div的ID
        layers: [gMap_s, gMap_h], //地图容器中加载的图层
        view: new ol.View({ // 地图视图设置
            center: ol.proj.fromLonLat([108.4, 22.75]), // 地图初始中心点
            maxZoom: 22,
            minZoom: 4, // 最小级别
            zoom: 12 // 地图初始显示级别

        }),
        controls: ol.control.defaults().extend([scaleLineControl, mousePositionControl])
    });

    var clearLayer = function() {
        var Layers = map.getLayers().getArray();
        var layerL = Layers.length;
        for (var i = 0; i < layerL; i++) {
            map.removeLayer(Layers[0]); //移除图层
        }
    }

    // 设置显示中心
    function setCenter(x, y) {
        var view = map.getView(); //获取地图视图
        var py = ol.proj.fromLonLat([x, y]);
        view.setCenter(py); //平移地图
        view.setZoom(12);
    }
    // setCenter(108.37, 22.78)

    $("#layer_h").click(function () {
        var Layers = map.getLayers().getArray();
        var layerL = Layers.length;
        if(layerL == 1){ // 只有一个图层，说明没有路网层，进行显示处理
            map.addLayer(LayerArr[3]);
        }else { // 隐藏路网层
            clearLayer(); //清空底图
            var display = $('#layer_s').css('display');
            if (display == 'none') { // 显示卫星图层按钮被隐藏，说明底图为卫星图层
                map.addLayer(LayerArr[2]);
            }else {
                map.addLayer(LayerArr[1]);
            }
        }
    });

    // 显示卫星地图
    $("#layer_s").click(function () {
        $(this).hide();
        $("#layer_m").show();
        clearLayer();
        map.addLayer(LayerArr[2]);
        map.addLayer(LayerArr[3]);

    });

    // 显示2D地图
    $("#layer_m").click(function () {
        $(this).hide();
        $("#layer_s").show();
        clearLayer();
        map.addLayer(LayerArr[1]);
        map.addLayer(LayerArr[3]);
    });


</script>
</html>
